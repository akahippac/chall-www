#!/usr/bin/env python2

# Just a super simple frontend for me to test the service (manually)
from pwn import *
#context.log_level = 'debug'

import sys
import re
import os
import PIL.Image
import base64
import StringIO


def main():
    if len(sys.argv) != 3:
        print "usage: client.py <ip> <port>"
        sys.exit(-1)
    
    ip = sys.argv[1]
    port = sys.argv[2]

    conn = remote(ip, port)

    print conn.recvuntil("What URL would you like this old dog to fetch?")
    conn.sendline("http://example.com")
    print conn.recvuntil("Booting up")

    # Now, just keep reading in lines from the connect
    # if we have a line that starts with "PIC", it is a JPEG screenshot
    while True:
        response = conn.recvline()

        if response.startswith("DEBUG"):
            img_b64 = response[6:]
            img = base64.b64decode(img_b64)
            io = StringIO.StringIO()
            io.write(img)
            io.seek(0)
            
            i = PIL.Image.open(io)
            i.show()
        else:
            print response
            
        
        
    

if __name__ == '__main__':
    main()

